{% extends 'website/base.html' %}
{% load static %}
{% load website_tags %}

{% block description %}
  {% if article.description %}
    <meta name="description" content="{{ article.description }}">
  {% endif %}
{% endblock %}

{% block title %}{{ article.title|cut_number }}{% endblock %}

{% block extra_head %}
  <script src="{% static 'website/js/comments.js' %}"></script>
  <script src="https://yastatic.net/share2/share.js" defer></script>
  <script id="MathJax-script" async src="{% static 'vendor/mathjax/js/tex-mml-svg.js' %}"></script>
{% endblock %}

{% block sidebar %}
  {% include 'website/includes/sidebar_content.html' %}
{% endblock %}

{% block content %}
  <article class="article-content card">
    <div class="article-header">
      <h1>{{ article.title|cut_number }}</h1>
    <div class="summary-meta">
      <span class="summary-date"><i class="fa-regular fa-calendar"></i> {{ article.created_date|date:"d.m.Y" }}</span>
      <div class="summary-stats">
        <span><i class="fa-regular fa-eye"></i> {{ article.views }}</span>
        <span><i class="fa-regular fa-comments"></i> {% get_comments_count article as comments_count %}{{ comments_count }}</span>
        {% if user.is_authenticated %}
          <a href="{{ article.get_admin_url }}" class="object_edit">
            <i class="fas fa-edit"></i>
          </a>
        {% endif %}
      </div>
    </div>

    <div class="article-text">{{ article.body|safe }}<div>

    <div class="nav-buttons">
      {% get_next_and_prev_article article as articles %}
      {% if articles.prev_article %}
        <a href="{{ articles.prev_article.get_absolute_url }}" class="nav-button"><i class="fas fa-arrow-left"></i> <span class="nav-command">Назад</span></a>
      {% else %}
        <span class="nav-button nav-text"><i class="fas fa-arrow-left"></i> <span>Назад</span></span>
      {% endif %}

      <div class="share-block" id="shareBlock">
        <button class="share-toggle-btn" id="shareToggleBtn">
          <i class="fas fa-share-alt"></i> <span class="nav-command">Поделиться</span>
        </button>
        <div class="share-icons">
          <span class="ya-share2" data-curtain data-limit="6" data-more-button-type="short" 
            data-title="{{ article.title|cut_number }}"
            data-description="{{ article.summary }}"
            {% if article.image %}
              data-image="{{ article.image.url }}"
            {% endif %}
            data-services="vkontakte,telegram,whatsapp,odnoklassniki,">
          </span>
        </div>
      </div>

      {% if articles.next_article %}
        <a href="{{ articles.next_article.get_absolute_url }}" class="nav-button"><span class="nav-command">Далее</span> <i class="fas fa-arrow-right"></i></a>
      {% else %}
        <span class="nav-button nav-text"><span>Далее</span> <i class="fas fa-arrow-right"></i></span>
      {% endif %}
    </div>
  </article>

{% include "website/includes/comments.html" %}
{% endblock %}
